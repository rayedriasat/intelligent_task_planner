<div class="task-card task-card-{{ task.status }}" 
     data-task-id="{{ task.id }}" 
     id="task-{{ task.id }}">
    
    <div class="flex justify-between items-start mb-2">
        <h3 class="font-medium text-sm">{{ task.title }}</h3>
        <div class="flex items-center space-x-1">
            <!-- Priority Indicator -->
            <div class="priority-indicator priority-{% if task.priority == 1 %}low{% elif task.priority == 2 %}medium{% elif task.priority == 3 %}high{% else %}urgent{% endif %}"></div>
            
            <!-- Lock Status -->
            {% if task.is_locked %}
                <svg class="w-3 h-3 text-text-secondary dark:text-dark-text-secondary" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 1L3 5V11C3 16.55 6.84 21.74 12 23C17.16 21.74 21 16.55 21 11V5L12 1M12 7C13.4 7 14.8 8.6 14.8 10V11.5C15.4 11.5 16 12.4 16 13V16C16 17 15.4 17.8 14.8 17.8H9.2C8.6 17.8 8 17 8 16V13C8 12.4 8.6 11.5 9.2 11.5V10C9.2 8.6 10.6 7 12 7M12 8.2C11.2 8.2 10.5 8.7 10.5 10V11.5H13.5V10C13.5 8.7 12.8 8.2 12 8.2Z"/>
                </svg>
            {% endif %}
        </div>
    </div>

    {% if task.description %}
        <p class="text-xs text-text-secondary dark:text-dark-text-secondary mb-3">{{ task.description|truncatewords:10 }}</p>
    {% endif %}

    <div class="text-xs text-text-secondary dark:text-dark-text-secondary space-y-1">
        <div>Due: {{ task.deadline|date:"M d, H:i" }}</div>
        <div>{{ task.estimated_hours }}h estimated</div>
        {% if task.is_scheduled %}
            <div class="text-primary dark:text-dark-primary">
                Scheduled: {{ task.start_time|date:"M d, H:i" }}
            </div>
        {% endif %}
    </div>

    <!-- Actions -->
    <div class="flex justify-between items-center mt-3">
        <div class="flex space-x-1">
            <button onclick="updateTaskStatusWithConfetti({{ task.id }}, '{% if task.status == 'todo' %}in_progress{% elif task.status == 'in_progress' %}completed{% else %}todo{% endif %}')" 
                    class="text-xs px-2 py-1 rounded bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all duration-200">
                {% if task.status == 'todo' %}Start{% elif task.status == 'in_progress' %}Complete{% else %}Reopen{% endif %}
            </button>
        </div>
        
        <div class="flex space-x-1">
            <button onclick="toggleTaskLock({{ task.id }})" 
                    class="text-xs p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200">
                {% if task.is_locked %}
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10A2,2 0 0,1 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                    </svg>
                {% else %}
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V7C15.8,6.39 14.4,6 12.93,6C11.75,6 10.62,6.23 9.59,6.64C10.03,6.11 10.62,5.74 11.27,5.74C12.5,5.74 13.5,6.74 13.5,8V8H18Z"/>
                    </svg>
                {% endif %}
            </button>
            
            <a href="{% url 'planner:task_detail' task.id %}" 
               class="text-xs p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057 5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
            </a>
        </div>
    </div>
</div>

<script>
function toggleTaskLock(taskId) {
    fetch(`/tasks/${taskId}/lock/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => {
        if (response.ok) {
            // Subtle update without reload
            console.log('Task lock toggled');
        }
    })
    .catch(error => console.error('Error:', error));
}
</script>
